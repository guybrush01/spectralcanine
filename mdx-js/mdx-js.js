function BinaryStream(b){var a;this.data=get(b,true);this.buffer=new ArrayBuffer(this.data.length);this.index=0;this.dataview=new DataView(this.buffer);for(a=0;a<this.buffer.byteLength;a++){this.dataview.setUint8(a,this.data.charCodeAt(a))}}BinaryStream.prototype={size:function(){return this.buffer.byteLength},sizeRemaining:function(){return this.buffer.byteLength-this.index},skip:function(a){this.index+=a;if(this.index>this.size()){this.index=this.size()-1;console.log("Exception: clamping illegal internal index")}else{if(this.index<0){this.index=0;console.log("Exception: clamping illegal internal index")}}return this.index},read:function(b){if(this.sizeRemaining()>=b){var c=new Array(b);var a;for(a=0;a<b;a++){c[a]=String.fromCharCode(String(this.dataview.getUint8(this.index+a)))}this.index+=b;return c.join("")}else{console.log("Exception: illegal operation (causes buffer overflow)");return null}},readInt8:function(){if(this.sizeRemaining()>0){var a=this.dataview.getInt8(this.index);this.index+=1;return a}else{console.log("Exception: illegal operation (causes buffer overflow)");return null}},readInt8Array:function(b){if(this.sizeRemaining()>=b){var c=[];var a;for(a=0;a<b;a++){c[a]=this.dataview.getInt8(this.index+a)}this.index+=b;return c}else{console.log("Exception: illegal operation (causes buffer overflow)");return null}},readInt16:function(){if(this.sizeRemaining()>=2){var a=this.dataview.getInt16(this.index,true);this.index+=2;return a}else{console.log("Exception: illegal operation (causes buffer overflow)");return null}},readInt16Array:function(b){if(this.sizeRemaining()>=(b*2)){var c=[];var a;for(a=0;a<b;a++){c[a]=this.dataview.getInt16(this.index+(a*2),true)}this.index+=b*2;return c}else{console.log("Exception: illegal operation (causes buffer overflow)");return null}},readInt32:function(){if(this.sizeRemaining()>=4){var a=this.dataview.getInt32(this.index,true);this.index+=4;return a}else{console.log("Exception: illegal operation (causes buffer overflow)");return null}},readInt32Array:function(b){if(this.sizeRemaining()>=(b*4)){var c=[];var a;for(a=0;a<b;a++){c[a]=this.dataview.getInt32(this.index+(a*4),true)}this.index+=b*4;return c}else{console.log("Exception: illegal operation (causes buffer overflow)");return null}},readUint8:function(){if(this.sizeRemaining()>0){var a=this.dataview.getUint8(this.index);this.index+=1;return a}else{console.log("Exception: illegal operation (causes buffer overflow)");return null}},readUint8Array:function(b){if(this.sizeRemaining()>=b){var c=[];var a;for(a=0;a<b;a++){c[a]=this.dataview.getUint8(this.index+a)}this.index+=b;return c}else{console.log("Exception: illegal operation (causes buffer overflow)");return null}},readUint16:function(){if(this.sizeRemaining()>=2){var a=this.dataview.getUint16(this.index,true);this.index+=2;return a}else{console.log("Exception: illegal operation (causes buffer overflow)");return null}},readUint16Array:function(b){if(this.sizeRemaining()>=(b*2)){var c=[];var a;for(a=0;a<b;a++){c[a]=this.dataview.getUint16(this.index+(a*2),true)}this.index+=b*2;return c}else{console.log("Exception: illegal operation (causes buffer overflow)");return null}},readUint32:function(){if(this.sizeRemaining()>=4){var a=this.dataview.getUint32(this.index,true);this.index+=4;return a}else{console.log("Exception: illegal operation (causes buffer overflow)");return null}},readUint32Array:function(b){if(this.sizeRemaining()>=(b*4)){var c=[];var a;for(a=0;a<b;a++){c[a]=this.dataview.getUint32(this.index+(a*4),true)}this.index+=b*4;return c}else{console.log("Exception: illegal operation (causes buffer overflow)");return null}},readFloat32:function(){if(this.sizeRemaining()>=4){var a=this.dataview.getFloat32(this.index,true);this.index+=4;return a}else{console.log("Exception: illegal operation (causes buffer overflow)");return null}},readFloat32Array:function(b){if(this.sizeRemaining()>=(b*4)){var c=[];var a;for(a=0;a<b;a++){c[a]=this.dataview.getFloat32(this.index+(a*4),true)}this.index+=b*4;return c}else{console.log("Exception: illegal operation (causes buffer overflow)");return null}},readFloat64:function(){if(this.sizeRemaining()>=8){var a=this.dataview.getFloat64(this.index,true);this.index+=8;return a}else{console.log("Exception: illegal operation (causes buffer overflow)");return null}},readFloat64Array:function(b){if(this.sizeRemaining()>=(b*8)){var c=[];var a;for(a=0;a<b;a++){c[a]=this.dataview.getFloat64(this.index+(a*8),true)}this.index+=b*8;return c}else{console.log("Exception: illegal operation (causes buffer overflow)");return null}},readExpected:function(b){if(this.sizeRemaining()>=b.length){var a=this.read(b.length);if(a===b){return true}else{console.log("Exception: expected "+b+" but found "+a);return false}}else{console.log("Exception: illegal operation (causes buffer overflow)");return null}},readHeader:function(){if(this.sizeRemaining()>=8){return new Header(this)}else{return null}}};BinaryParser=function(b,a){this.bigEndian=b,this.allowExceptions=a};with({p:BinaryParser.prototype}){p.encodeFloat=function(a,z,f){var d=Math.pow(2,f-1)-1,c=-d+1,m=d,y=c-z,l=isNaN(k=parseFloat(a))||k==-Infinity||k==+Infinity?k:0,e=0,u=2*d+1+z+3,h=new Array(u),v=(k=l!==0?0:k)<0,k=Math.abs(k),o=Math.floor(k),b=k-o,s,x,w,q,g;for(s=u;s;h[--s]=0){}for(s=d+2;o&&s;h[--s]=o%2,o=Math.floor(o/2)){}for(s=d+1;b>0&&s;(h[++s]=((b*=2)>=1)-0)&&--b){}for(s=-1;++s<u&&!h[s];){}if(h[(x=z-1+(s=(e=d+1-s)>=c&&e<=m?s+1:d+1-(e=c-1)))+1]){if(!(w=h[x])){for(q=x+2;!w&&q<u;w=h[q++]){}}for(q=x+1;w&&--q>=0;(h[q]=!h[q]-0)&&(w=0)){}}for(s=s-2<0?-1:s-3;++s<u&&!h[s];){}(e=d+1-s)>=c&&e<=m?++s:e<c&&(e!=d+1-u&&e<y&&this.warn("encodeFloat::float underflow"),s=d+1-(e=c-1));(o||l!==0)&&(this.warn(o?"encodeFloat::float overflow":"encodeFloat::"+l),e=m+1,s=d+2,l==-Infinity?v=1:isNaN(l)&&(h[s]=1));for(k=Math.abs(e+d),q=f+1,g="";--q;g=(k%2)+g,k=k>>=1){}for(k=0,q=0,s=(g=(v?"1":"0")+g+h.slice(s,s+z).join("")).length,r=[];s;k+=(1<<q)*g.charAt(--s),q==7&&(r[r.length]=String.fromCharCode(k),k=0),q=(q+1)%8){}r[r.length]=k?String.fromCharCode(k):"";return(this.bigEndian?r.reverse():r).join("")};p.encodeInt=function(d,e,b){var a=Math.pow(2,e),c=[];(d>=a||d<-(a>>1))&&this.warn("encodeInt::overflow")&&(d=0);d<0&&(d+=a);for(;d;c[c.length]=String.fromCharCode(d%256),d=Math.floor(d/256)){}for(e=-(-e>>3)-c.length;e--;c[c.length]="\0"){}return(this.bigEndian?c.reverse():c).join("")};p.decodeFloat=function(f,c,n){var l=((l=new this.Buffer(this.bigEndian,f)).checkBuffer(c+n+1),l),g=Math.pow(2,n-1)-1,j=l.readBits(c+n,1),k=l.readBits(c,n),i=0,d=2,a=l.buffer.length+(-c>>3)-1,e,h,m;do{for(e=l.buffer[++a],h=c%8||8,m=1<<h;m>>=1;(e&m)&&(i+=1/d),d*=2){}}while(c-=h);return k==(g<<1)+1?i?NaN:j?-Infinity:+Infinity:(1+j*-2)*(k||i?!k?Math.pow(2,-g+1)*i:Math.pow(2,k-g)*(1+i):0)};p.decodeInt=function(g,f,e){var d=new this.Buffer(this.bigEndian,g),c=d.readBits(0,f),a=Math.pow(2,f);return e&&c>=a/2?c-a:c};with({p:(p.Buffer=function(b,a){this.bigEndian=b||0,this.buffer=[],this.setBuffer(a)}).prototype}){p.readBits=function(b,d){function c(k,j){for(++j;--j;k=((k%=2147483647+1)&1073741824)==1073741824?k*2:(k-1073741824)*2+2147483647+1){}return k}if(b<0||d<=0){return 0}this.checkBuffer(b+d);for(var e,f=b%8,a=this.buffer.length-(b>>3)-1,i=this.buffer.length+(-(b+d)>>3),h=a-i,g=((this.buffer[a]>>f)&((1<<(h?8-f:d))-1))+(h&&(e=(b+d)%8)?(this.buffer[i++]&((1<<e)-1))<<(h--<<3)-f:0);h;g+=c(this.buffer[i++],(h--<<3)-f)){}return g};p.setBuffer=function(e){if(e){for(var c,d=c=e.length,a=this.buffer=new Array(c);d;a[c-d]=e.charCodeAt(--d)){}this.bigEndian&&a.reverse()}};p.hasNeededBits=function(a){return this.buffer.length>=-(-a>>3)};p.checkBuffer=function(a){if(!this.hasNeededBits(a)){throw new Error("checkBuffer::missing bytes")}}}p.warn=function(a){if(this.allowExceptions){throw new Error(a)}return 1};p.toSmall=function(a){return this.decodeInt(a,8,true)};p.fromSmall=function(a){return this.encodeInt(a,8,true)};p.toByte=function(a){return this.decodeInt(a,8,false)};p.fromByte=function(a){return this.encodeInt(a,8,false)};p.toShort=function(a){return this.decodeInt(a,16,true)};p.fromShort=function(a){return this.encodeInt(a,16,true)};p.toWord=function(a){return this.decodeInt(a,16,false)};p.fromWord=function(a){return this.encodeInt(a,16,false)};p.toInt=function(a){return this.decodeInt(a,32,true)};p.fromInt=function(a){return this.encodeInt(a,32,true)};p.toDWord=function(a){return this.decodeInt(a,32,false)};p.fromDWord=function(a){return this.encodeInt(a,32,false)};p.toFloat=function(a){return this.decodeFloat(a,23,8)};p.fromFloat=function(a){return this.encodeFloat(a,23,8)};p.toDouble=function(a){return this.decodeFloat(a,52,11)};p.fromDouble=function(a){return this.encodeFloat(a,52,11)}}var haveDataView=(typeof window.DataView==="undefined")?false:true;function BinaryStream(b){this.data=get(b,true);if(haveDataView){this.buffer=new ArrayBuffer(this.data.length);this.dataview=new DataView(this.buffer);for(var a=0;a<this.buffer.byteLength;a++){this.dataview.setUint8(a,this.data.charCodeAt(a))}}else{for(var a=0;a<this.data.length;a++){this.data[a]=this.data.charCodeAt(a)&255}this.parser=new BinaryParser();this.sub=function(d,c){return this.data.substring(d,d+c)}}this.index=0}BinaryStream.prototype={size:function(){if(haveDataView){return this.buffer.byteLength}else{return this.data.length}},sizeRemaining:function(){if(haveDataView){return this.buffer.byteLength-this.index}else{return this.data.length-this.index}},skip:function(a){this.index+=a;if(this.index>this.size()){this.index=this.size()-1;console.log("Exception: clamping illegal internal index")}else{if(this.index<0){this.index=0;console.log("Exception: clamping illegal internal index")}}return this.index},read:function(b){if(this.sizeRemaining()>=b){var c=Array(b);for(var a=0;a<b;a++){if(haveDataView){c[a]=String.fromCharCode(String(this.dataview.getUint8(this.index+a)))}else{c[a]=String.fromCharCode(this.parser.decodeInt(this.sub(this.index+a,1),8,false))}}this.index+=b;return c.join("")}else{console.log("Exception: illegal operation (causes buffer overflow)");return null}},readInt8:function(){if(this.sizeRemaining()>0){if(haveDataView){var a=this.dataview.getInt8(this.index)}else{var a=this.parser.decodeInt(this.sub(this.index,1),8,true)}this.index+=1;return a}else{console.log("Exception: illegal operation (causes buffer overflow)");return null}},readInt8Array:function(b){if(this.sizeRemaining()>=b){var c=[];for(var a=0;a<b;a++){if(haveDataView){c[a]=this.dataview.getInt8(this.index)}else{c[a]=this.parser.decodeInt(this.sub(this.index,1),8,true)}this.index+=1}return c}else{console.log("Exception: illegal operation (causes buffer overflow)");return null}},readInt16:function(){if(this.sizeRemaining()>=2){if(haveDataView){var a=this.dataview.getInt16(this.index,true)}else{var a=this.parser.decodeInt(this.sub(this.index,2),16,true)}this.index+=2;return a}else{console.log("Exception: illegal operation (causes buffer overflow)");return null}},readInt16Array:function(b){if(this.sizeRemaining()>=(b*2)){var c=[];for(var a=0;a<b;a++){if(haveDataView){c[a]=this.dataview.getInt16(this.index+(a*2),true)}else{c[a]=this.parser.decodeInt(this.sub(this.index+(a*2),2),16,true)}}this.index+=b*2;return c}else{console.log("Exception: illegal operation (causes buffer overflow)");return null}},readInt32:function(){if(this.sizeRemaining()>=4){if(haveDataView){var a=this.dataview.getInt32(this.index,true)}else{var a=this.parser.decodeInt(this.sub(this.index,4),32,true)}this.index+=4;return a}else{console.log("Exception: illegal operation (causes buffer overflow)");return null}},readInt32Array:function(b){if(this.sizeRemaining()>=(b*4)){var c=[];for(var a=0;a<b;a++){if(haveDataView){c[a]=this.dataview.getInt32(this.index+(a*4),true)}else{c[a]=this.parser.decodeInt(this.sub(this.index+(a*4),4),32,true)}}this.index+=b*4;return c}else{console.log("Exception: illegal operation (causes buffer overflow)");return null}},readUint8:function(){if(this.sizeRemaining()>0){if(haveDataView){var a=this.dataview.getUint8(this.index)}else{var a=this.parser.decodeInt(this.sub(this.index,1),8,false)}this.index+=1;return a}else{console.log("Exception: illegal operation (causes buffer overflow)");return null}},readUint8Array:function(b){if(this.sizeRemaining()>=b){var c=[];for(var a=0;a<b;a++){if(haveDataView){c[a]=this.dataview.getUint8(this.index+a)}else{c[a]=this.parser.decodeInt(this.sub(this.index+a,1),8,false)}}this.index+=b;return c}else{console.log("Exception: illegal operation (causes buffer overflow)");return null}},readUint16:function(){if(this.sizeRemaining()>=2){if(haveDataView){var a=this.dataview.getUint16(this.index,true)}else{var a=this.parser.decodeInt(this.sub(this.index,2),16,false)}this.index+=2;return a}else{console.log("Exception: illegal operation (causes buffer overflow)");return null}},readUint16Array:function(b){if(this.sizeRemaining()>=(b*2)){var c=[];for(var a=0;a<b;a++){if(haveDataView){c[a]=this.dataview.getUint16(this.index+(a*2),true)}else{c[a]=this.parser.decodeInt(this.sub(this.index+(a*2),2),16,false)}}this.index+=b*2;return c}else{console.log("Exception: illegal operation (causes buffer overflow)");return null}},readUint32:function(){if(this.sizeRemaining()>=4){if(haveDataView){var a=this.dataview.getUint32(this.index,true)}else{var a=this.parser.decodeInt(this.sub(this.index,4),32,false)}this.index+=4;return a}else{console.log("Exception: illegal operation (causes buffer overflow)");return null}},readUint32Special:function(){if(this.sizeRemaining()>=4){if(haveDataView){var a=this.dataview.getUint32(this.index,true)}else{var a=this.parser.toByte(this.sub(this.index,4));var b=this.parser.toByte(this.sub(this.index+1,4));console.log(this.sub(this.index,4)+" === "+a+" === "+b);var a=this.parser.toDWord(this.sub(this.index,4))}this.index+=4;return a}else{console.log("Exception: illegal operation (causes buffer overflow)");return null}},readUint32Array:function(b){if(this.sizeRemaining()>=(b*4)){var c=[];for(var a=0;a<b;a++){if(haveDataView){c[a]=this.dataview.getUint32(this.index+(a*4),true)}else{c[a]=this.parser.decodeInt(this.sub(this.index+(a*4),4),32,false)}}this.index+=b*4;return c}else{console.log("Exception: illegal operation (causes buffer overflow)");return null}},readFloat32:function(){if(this.sizeRemaining()>=4){if(haveDataView){var a=this.dataview.getFloat32(this.index,true)}else{var a=this.parser.decodeFloat(this.sub(this.index,4),23,8,false)}this.index+=4;return a}else{console.log("Exception: illegal operation (causes buffer overflow)");return null}},readFloat32Array:function(b){if(this.sizeRemaining()>=(b*4)){var c=[];for(var a=0;a<b;a++){if(haveDataView){c[a]=this.dataview.getFloat32(this.index+(a*4),true)}else{var c=this.parser.decodeFloat(this.sub(this.index+(a*4),4),23,8,false)}}this.index+=b*4;return c}else{console.log("Exception: illegal operation (causes buffer overflow)");return null}},readFloat64:function(){if(this.sizeRemaining()>=8){if(haveDataView){var a=this.dataview.getFloat64(this.index,true)}else{var a=this.parser.decodeFloat(this.sub(this.index,8),52,11,false)}this.index+=8;return a}else{console.log("Exception: illegal operation (causes buffer overflow)");return null}},readFloat64Array:function(b){if(this.sizeRemaining()>=(b*8)){var c=[];for(var a=0;a<b;a++){if(haveDataView){c[a]=this.dataview.getFloat64(this.index+(a*8),true)}else{c[a]=this.parser.decodeFloat(this.sub(this.index+(a*8),8),52,11,false)}}this.index+=b*8;return c}else{console.log("Exception: illegal operation (causes buffer overflow)");return null}},readExpected:function(b){if(this.sizeRemaining()>=b.length){var a=this.read(b.length);if(a===b){return true}else{console.log("Exception: expected "+b+" but found "+a);return false}}else{console.log("Exception: illegal operation (causes buffer overflow)");return null}},readHeader:function(){if(this.sizeRemaining()>=8){return new Header(this)}else{return null}}};function get(a,d){var b=new XMLHttpRequest();var c;b.onreadystatechange=function(){if(b.readyState===4){if(b.status===200){c=b.responseText;console.log("sync loaded "+a+" ("+c.length+" bytes)")}else{console.log("sync failed to load "+a)}}};b.open("GET",a,false);if(d===true){b.overrideMimeType("text/plain; charset=x-user-defined")}b.send("");return c}function getA(a,d){var b=new XMLHttpRequest();var c;b.onreadystatechange=function(){if(b.readyState===4){if(b.status===200){c=b.responseText;console.log("async loaded "+a+" ("+c.length+" bytes)")}else{console.log("async failed to load "+a)}}};b.open("GET",a,true);if(d===true){b.overrideMimeType("text/plain; charset=x-user-defined")}b.send("");return c}function GlState(){this.shaders={};this.programs=[];this.currentProgram=null;this.projectionMatrix=Mat4.identity();this.modelviewMatrix=Mat4.identity();this.textures=[];this.currentTexture={}}GlState.prototype={getShader:function(a,b){if(this.shaders[a]!==undefined){return this.shaders[a]}else{var c=new Shader(a,b);this.shaders[a]=c;return c}},createProgram:function(a,c){var b=new Program(a,c);return b},useProgram:function(b){var a;var d;var c;if(this.currentProgram!==null){a=this.currentProgram.attributes;d=Object.keys(a);for(c=0;c<d.length;c++){Gl.disableVertexAttribArray(a[d[c]])}}this.currentProgram=b;Gl.useProgram(b.id);a=this.currentProgram.attributes;d=Object.keys(a);for(c=0;c<d.length;c++){Gl.enableVertexAttribArray(a[d[c]])}},usedProgram:function(){return this.currentProgram},bindProjection:function(a){Gl.uniformMatrix4fv(this.currentProgram.uniforms[a],Gl.FALSE,this.projectionMatrix)},bindModelview:function(a){Gl.uniformMatrix4fv(this.currentProgram.uniforms[a],Gl.FALSE,this.modelviewMatrix)},bindTransform:function(a){Gl.uniformMatrix4fv(this.currentProgram.uniforms[a],Gl.FALSE,Mat4.multMatrix(this.projectionMatrix,this.modelviewMatrix))},ortho:function(f,c,b,e,d,a){this.projectionMatrix=Mat4.ortho(f,c,b,e,d,a)},perspective:function(b,a,d,c){this.projectionMatrix=Mat4.perspective(b,a,d,c)},translate:function(a){this.modelviewMatrix=Mat4.multMatrix(this.modelviewMatrix,Mat4.translation(a))},rotate:function(b,a){this.modelviewMatrix=Mat4.multMatrix(this.modelviewMatrix,Mat4.rotation(b,a))},scale:function(a){this.modelviewMatrix=Mat4.multMatrix(this.modelviewMatrix,Mat4.scaling(a))},loadIdentity:function(){this.modelviewMatrix=Mat4.identity()},pushMatrix:function(){this.matrixStack.push(this.modelviewMatrix.copy())},popMatrix:function(){this.modelviewMatrix=this.matrixStack.pop()},getTexture:function(a){if(this.textures[a]){return this.textures[a]}else{var b=new Texture(a);this.textures[a]=b;return b}},bindTexture:function(b,a){this.currentTexture[b]=a;Gl.activeTexture(b);Gl.bindTexture(Gl.TEXTURE_2D,a.id)},boundTexture:function(a){return this.currentTexture[a]}};function Shader(a,b){this.file=a;this.type=b;this.source=get(a);this.id=Gl.createShader(b);console.log("registering shader object "+this.id);Gl.shaderSource(this.id,this.source);Gl.compileShader(this.id)}Shader.prototype={getParameter:function(a){return Gl.getShaderParameter(this.id,a)},getInfoLog:function(){return Gl.getShaderInfoLog(this.id)}};function Program(h,c){var j=Gl.state.getShader(h,Gl.VERTEX_SHADER);var e=Gl.state.getShader(c,Gl.FRAGMENT_SHADER);var f;var g;var d;if(j.getParameter(Gl.COMPILE_STATUS)&&e.getParameter(Gl.COMPILE_STATUS)){this.id=Gl.createProgram();Gl.attachShader(this.id,j.id);Gl.attachShader(this.id,e.id);Gl.linkProgram(this.id);if(Gl.getProgramParameter(this.id,Gl.LINK_STATUS)===true){this.uniforms={};this.attributes={};f=Gl.getProgramParameter(this.id,Gl.ACTIVE_UNIFORMS);for(d=0;d<f;d++){var a=Gl.getActiveUniform(this.id,d);g=Gl.getUniformLocation(this.id,a.name);this.uniforms[a.name]=g}f=Gl.getProgramParameter(this.id,Gl.ACTIVE_ATTRIBUTES);for(d=0;d<f;d++){var b=Gl.getActiveAttrib(this.id,d);g=Gl.getAttribLocation(this.id,b.name);this.attributes[b.name]=g}}else{console.log("Error: the program object failed to link")}}else{console.log("Error: one or both of the shaders failed to compile")}}Program.prototype={uniform1i:function(b,a){Gl.uniform1i(this.uniforms[b],a)}};function Texture(a){this.file=a;this.id=Gl.createTexture();this.image=new Image();this.image.src=a;var a=this.file;var b=this.id;this.image.onload=function(){Gl.bindTexture(Gl.TEXTURE_2D,b);Gl.texImage2D(Gl.TEXTURE_2D,0,Gl.RGBA,Gl.RGBA,Gl.UNSIGNED_BYTE,this);Gl.texParameteri(Gl.TEXTURE_2D,Gl.TEXTURE_MAG_FILTER,Gl.LINEAR);Gl.texParameteri(Gl.TEXTURE_2D,Gl.TEXTURE_MIN_FILTER,Gl.LINEAR_MIPMAP_NEAREST);Gl.generateMipmap(Gl.TEXTURE_2D);console.log("loaded image "+a)}}Texture.prototype={};function Header(a){this.token=a.read(4);this.size=a.readUint32()}function MdxGeosetTranslation(a){}function MdxGeosetRotation(a){}function MdxGeosetScaling(a){}function MdxGeosetAlpha(c){var b=c.readUint32();var a;this.interpolationType=c.readUint32();this.globalSequenceId=c.readUint32();this.alphaTracks=new Array(b);for(a=0;a<b;a++){this.alphaTracks[a]=new MdxAlphaTrack(c,this.interpolationType)}if(typeof debug!=="undefined"){console.log("\t\t\tinterpolationType = "+this.interpolationType);console.log("\t\t\tglobalSequenceId = "+this.globalSequenceId);console.log("\t\t\talphaTracks = "+this.alphaTracks.length+" [...]")}}function MdxGeosetColor(c){var b=c.readUint32();var a;this.interpolationType=c.readUint32();this.globalSequenceId=c.readUint32();this.colorTracks=new Array(b);for(a=0;a<b;a++){this.colorTracks[a]=new MdxColorTrack(c,this.interpolationType)}if(typeof debug!=="undefined"){console.log("\t\t\tinterpolationType = "+this.interpolationType);console.log("\t\t\tglobalSequenceId = "+this.globalSequenceId);console.log("\t\t\tcolorTracks = "+this.colorTracks.length+" [...]")}}function MdxTextureTranslation(a){}function MdxTextureRotation(a){}function MdxTextureScaling(a){}function MdxCameraPositionTranslation(a){}function MdxCameraTargetTranslation(a){}function MdxCameraRotation(a){}function MdxMaterialTextureId(c){var b=c.readUint32();var a;this.interpolationType=c.readUint32();this.globalSequenceId=c.readUint32();this.textureIdTracks=new Array(b);for(a=0;a<b;a++){this.textureIdTracks[a]=new MdxTextureIdTrack(c,this.interpolationType)}if(typeof debug!=="undefined"){console.log("\t\t\t\t\tinterpolationType = "+this.interpolationType);console.log("\t\t\t\t\tglobalSequenceId = "+this.globalSequenceId);console.log("\t\t\t\t\ttextureIdTracks = "+this.textureIdTracks.length+" [...]")}}function MdxMaterialAlpha(c){var b=c.readUint32();var a;this.interpolationType=c.readUint32();this.globalSequenceId=c.readUint32();this.alphaTracks=new Array(b);for(a=0;a<b;a++){this.alphaTracks[a]=new MdxAlphaTrack(c,this.interpolationType)}if(typeof debug!=="undefined"){console.log("\t\t\t\t\tinterpolationType = "+this.interpolationType);console.log("\t\t\t\t\tglobalSequenceId = "+this.globalSequenceId);console.log("\t\t\t\t\talphaTracks = "+this.alphaTracks.length+" [...]")}}function MdxAttachmentVisibility(a){}function MdxLightVisibility(a){}function MdxLightColor(a){}function MdxLightIntensity(a){}function MdxLightAmbientColor(a){}function MdxLightAmbientIntensity(a){}function MdxParticleEmitterVisibility(a){}function MdxParticleEmitter2Visibility(a){}function MdxParticleEmitter2EmissionRate(a){}function MdxParticleEmitter2Width(a){}function MdxParticleEmitter2Length(a){}function MdxParticleEmitter2Speed(a){}function MdxRibbonEmitterVisibility(a){}function MdxRibbonEmitterHeightAbove(a){}function MdxRibbonEmitterHeightBelow(a){}function MdxNode(a){}function MdxVersionChunk(b,a){log("VersionChunk...");this.version=b.readUint32();if(typeof debug!=="undefined"){console.log("\tversion = "+this.version)}log("OK")}function MdxModelChunk(b,a){log("ModelChunk...");this.name=b.read(80);this.animationFileName=b.read(260);this.boundsRadius=b.readFloat32();this.minimumExtent=b.readFloat32Array(3);this.maximumExtent=b.readFloat32Array(3);this.blendTime=b.readUint32();if(typeof debug!=="undefined"){console.log("\tname = "+this.name);console.log("\tanimationFileName = "+this.animationFileName);console.log("\tboundsRadius = "+this.boundsRadius);console.log("\tminimumExtent = "+this.minimumExtent);console.log("\tmaximumExtent = "+this.maximumExtent);console.log("\tblendTime = "+this.blendTime)}log("OK")}function MdxSequenceChunk(d,c){log("SequenceChunk...");var a=c/132;var b;this.sequences=new Array(a);for(b=0;b<a;b++){if(typeof debug!=="undefined"){console.log("\tsequence "+b)}this.sequences[b]=new MdxSequence(d)}log("OK")}function MdxGlobalSequenceChunk(d,c){log("GlobalSequenceChunk...");var a=c/4;var b;this.globalSequences=new Array(a);for(b=0;b<a;b++){if(typeof debug!=="undefined"){console.log("\tglobal sequence "+b)}this.globalSequences[b]=new MdxGlobalSequence(d)}log("OK")}function MdxTextureChunk(d,c){log("TextureChunk...");var a=c/268;var b;this.textures=new Array(a);for(b=0;b<a;b++){if(typeof debug!=="undefined"){console.log("\ttexture "+b)}this.textures[b]=new MdxTexture(d)}log("OK")}function MdxLayerChunk(d,c){var a=d.readUint32();var b;this.layers=new Array(a);for(b=0;b<a;b++){if(typeof debug!=="undefined"){console.log("\t\t\tlayer "+b)}this.layers[b]=new MdxLayer(d)}}function MdxMaterialChunk(d,b){log("MaterialChunk...");var c=0;var a=0;this.materials=[];while(a!==b){c=d.readUint32();a+=c;if(typeof debug!=="undefined"){console.log("\tmaterial "+this.materials.length)}this.materials.push(new MdxMaterial(d))}log("OK")}function MdxTextureAnimationChunk(b,a){console.log("TextureAnimationChunk...");b.skip(a);console.log("Oops, not impelemented yet")}function MdxGeosetChunk(d,b){log("GeosetChunk...");var c=0;var a=0;this.geosets=[];while(a!==b){c=d.readUint32();a+=c;if(typeof debug!=="undefined"){console.log("\tgeoset "+this.geosets.length)}this.geosets[this.geosets.length]=new MdxGeoset(d)}log("OK")}function MdxGeosetAnimationChunk(d,b){log("GeosetAnimationChunk...");var c=0;var a=0;this.geosetAnimations=[];while(a!==b){c=d.readUint32();a+=c;if(typeof debug!=="undefined"){console.log("\tgeosetAnimation "+this.geosetAnimations.length)}this.geosetAnimations[this.geosetAnimations.length]=new MdxGeosetAnimation(d)}log("OK")}function MdxBoneChunk(b,a){log("BoneChunk...");b.skip(a);log("Oops, not impelemented yet")}function MdxLightChunk(b,a){log("LightChunk...");b.skip(a);log("Oops, not impelemented yet")}function MdxHelperChunk(b,a){log("HelperChunk...");b.skip(a);log("Oops, not impelemented yet")}function MdxAttachmentChunk(b,a){log("AttachmentChunk...");b.skip(a);log("Oops, not impelemented yet")}function MdxPivotPointChunk(b,a){log("PivotPointChunk...");b.skip(a);log("Oops, not impelemented yet")}function MdxParticleEmitterChunk(b,a){log("ParticleEmitterChunk...");b.skip(a);log("Oops, not impelemented yet")}function MdxParticleEmitter2Chunk(b,a){log("ParticleEmitter2Chunk...");b.skip(a);log("Oops, not impelemented yet")}function MdxRibbonEmitterChunk(b,a){log("RibbonEmitterChunk...");b.skip(a);log("Oops, not impelemented yet")}function MdxTracks(b,a){}function MdxEventObjectChunk(b,a){log("EventObjectChunk...");b.skip(a);log("Oops, not impelemented yet")}function MdxCameraChunk(b,a){log("CameraChunk...");b.skip(a);log("Oops, not impelemented yet")}function MdxCollisionShapeChunk(b,a){log("CollisionShapeChunk...");b.skip(a);log("Oops, not impelemented yet")}function MdxTranslationTrack(a,b){this.time=a.readUint32();this.translation=a.readFloat32Array(3);if(b>1){this.inTan=a.readFloat32Array(3);this.outTan=a.readFloat32Array(3)}}function MdxRotationTrack(a,b){this.time=a.readUint32();this.rotation=a.readFloat32Array(4);if(b>1){this.inTan=a.readFloat32Array(4);this.outTan=a.readFloat32Array(4)}}function MdxScalingTrack(a,b){this.time=a.readUint32();this.scalling=a.readFloat32Array(3);if(b>1){this.inTan=a.readFloat32Array(3);this.outTan=a.readFloat32Array(3)}}function MdxAlphaTrack(a,b){this.time=a.readUint32();this.alpha=a.readFloat32();if(b>1){this.inTan=a.readFloat32();this.outTan=a.readFloat32()}}function MdxTextureIdTrack(a,b){this.time=a.readUint32();this.textureId=a.readUint32();if(b>1){this.inTan=a.readFloat32();this.outTan=a.readFloat32()}}function MdxColorTrack(a,b){this.time=a.readUint32();this.color=a.readFloat32Array(3);if(b>1){this.inTan=a.readFloat32Array(3);this.outTan=a.readFloat32Array(3)}}function MdxSequence(b){var a=b.read(80);this.name=a.substring(0,a.indexOf("\0"));this.intervalStart=b.readUint32();this.intervalEnd=b.readUint32();this.moveSpeed=b.readFloat32();this.flags=b.readUint32();this.rarity=b.readFloat32();this.syncPoint=b.readUint32();this.boundsRadius=b.readFloat32();this.minimumExtent=b.readFloat32Array(3);this.maximumExtent=b.readFloat32Array(3);if(typeof debug!=="undefined"){console.log("\t\tname = "+this.name);console.log("\t\tintervalStart = "+this.intervalStart);console.log("\t\tintervalEnd = "+this.intervalEnd);console.log("\t\tmoveSpeed = "+this.moveSpeed);console.log("\t\tflags = "+this.flags);console.log("\t\trarity = "+this.rarity);console.log("\t\tsyncPoint = "+this.syncPoint);console.log("\t\tboundsRadius = "+this.boundsRadius);console.log("\t\tminimumExtent = "+this.minimumExtent);console.log("\t\tmaximumExtent = "+this.maximumExtent)}}function MdxGlobalSequence(a){this.duration=a.readUint32();if(typeof debug!=="undefined"){console.log("\t\tduration = "+this.duration)}}function MdxTexture(a){this.replaceableId=a.readUint32();var b=a.read(260);this.fileName=b.substring(0,b.indexOf("\0")).replace(/\\/g,"/");this.flags=a.readUint32();if(typeof debug!=="undefined"){console.log("\t\treplaceableId = "+this.replaceableId);console.log("\t\tfileName = "+this.fileName);console.log("\t\tflags = "+this.flags)}if(this.fileName!==""){this.httpName=this.fileName.substring(0,this.fileName.lastIndexOf("."))+".png";this.texture=Gl.state.getTexture(this.httpName)}}function MdxLayer(d){var c=d.readUint32();var b;this.filterMode=d.readUint32();this.shadingFlags=d.readUint32();console.log(d.index);this.textureId=d.readUint32();console.log(this.textureId);this.textureAnimationId=d.readUint32();this.coordId=d.readUint32();this.alpha=d.readFloat32();if(typeof debug!=="undefined"){console.log("\t\t\t\tfilterMode = "+this.filterMode);console.log("\t\t\t\tshadingFlags = "+this.shadingFlags);console.log("\t\t\t\ttextureId = "+this.textureId);console.log("\t\t\t\ttextureAnimationId = "+this.textureAnimationId);console.log("\t\t\t\tcoordId = "+this.coordId);console.log("\t\t\t\talpha = "+this.alpha)}if(c>28){for(b=0;b<2;b++){var a=d.read(4);if(a==="KMTA"){if(typeof debug!=="undefined"){console.log("\t\t\t\tmaterialAlpha")}this.materialAlpha=new MdxMaterialAlpha(d)}else{if(a==="KMTF"){if(typeof debug!=="undefined"){console.log("\t\t\t\tmaterialTextureId")}this.materialTextureId=new MdxMaterialTextureId(d)}else{d.skip(-4)}}}}}function MdxMaterial(b){this.priorityPlane=b.readUint32();this.flags=b.readUint32();var a=b.read(4);if(typeof debug!=="undefined"){console.log("\t\tpriorityPlane = "+this.priorityPlane);console.log("\t\tflags = "+this.flags)}if(a==="LAYS"){if(typeof debug!=="undefined"){console.log("\t\tlayerChunk")}this.layerChunk=new MdxLayerChunk(b)}else{b.skip(-4)}}function MdxTextureAnimation(a){}function MdxGeoset(c){c.readExpected("VRTX");var o=c.readUint32();var s;var q;this.vertexPositions=new Array(o);for(s=0;s<o;s++){this.vertexPositions[s]=new MdxVertexPosition(c)}c.readExpected("NRMS");var n=c.readUint32();this.vertexNormals=new Array(n);for(s=0;s<n;s++){this.vertexNormals[s]=new MdxVertexNormal(c)}c.readExpected("PTYP");var v=c.readUint32();this.faceTypeGroups=new Array(v);for(s=0;s<v;s++){this.faceTypeGroups[s]=new MdxFaceTypeGroup(c)}c.readExpected("PCNT");var u=c.readUint32();this.faceGroups=new Array(u);for(s=0;s<u;s++){this.faceGroups[s]=new MdxFaceGroup(c)}c.readExpected("PVTX");var b=c.readUint32();var f=b/3;this.faces=new Array(f);for(s=0;s<f;s++){this.faces[s]=new MdxFace(c)}c.readExpected("GNDX");var w=c.readUint32();this.vertexGroups=new Array(w);for(s=0;s<w;s++){this.vertexGroups[s]=new MdxVertexGroup(c)}c.readExpected("MTGC");var h=c.readUint32();this.matrixGroups=new Array(h);for(s=0;s<h;s++){this.matrixGroups[s]=new MdxMatrixGroup(c)}c.readExpected("MATS");var l=c.readUint32();this.matrixIndexes=new Array(l);for(s=0;s<l;s++){this.matrixIndexes[s]=new MdxMatrixIndex(c)}this.materialId=c.readUint32();this.selectionGroup=c.readUint32();this.selectionFlags=c.readUint32();this.boundsRadius=c.readFloat32();this.minimumExtent=c.readFloat32Array(3);this.maximumExtent=c.readFloat32Array(3);var a=c.readUint32();this.extents=new Array(a);for(s=0;s<a;s++){this.extents[s]=new MdxExtent(c)}c.readExpected("UVAS");var m=c.readUint32();c.readExpected("UVBS");var k=c.readUint32();this.vertexTexturePositions=new Array(k);for(s=0;s<k;s++){this.vertexTexturePositions[s]=new MdxVertexTexturePosition(c)}if(typeof debug!=="undefined"){console.log("\t\tvertexPositions = "+this.vertexPositions.length+" [...]");console.log("\t\tvertexNormals = "+this.vertexNormals.length+" [...]");console.log("\t\tfaceTypeGroups = "+this.faceTypeGroups.length+" [...]");console.log("\t\tfaceGroups = "+this.faceGroups.length+" [...]");console.log("\t\tfaces = "+this.faces.length+" [...]");console.log("\t\tvertexGroups = "+this.vertexGroups.length+" [...]");console.log("\t\tmatrixGroups = "+this.matrixGroups.length+" [...]");console.log("\t\tmatrixIndexes = "+this.matrixIndexes.length+" [...]");console.log("\t\tmaterialId = "+this.materialId);console.log("\t\tselectionGroup = "+this.selectionGroup);console.log("\t\tselectionFlags = "+this.selectionFlags);console.log("\t\tboundsRadius = "+this.boundsRadius);console.log("\t\tminimumExtent = "+this.minimumExtent);console.log("\t\tmaximumExtent = "+this.maximumExtent);console.log("\t\textents = "+this.extents.length+" [...]");console.log("\t\tvertexTexturePositions = "+this.vertexTexturePositions.length+" [...]")}var e=new Float32Array(this.vertexPositions.length*8);var d=new Uint16Array(this.faces.length*3);for(s=0,q=0;s<this.vertexPositions.length;s++,q+=8){var z=this.vertexPositions[s].position;var y=this.vertexNormals[s].normal;var x=this.vertexTexturePositions[s].texturePosition;e[q]=z[0];e[q+1]=z[1];e[q+2]=z[2];e[q+3]=y[0];e[q+4]=y[1];e[q+5]=y[2];e[q+6]=x[0];e[q+7]=x[1]}for(s=0,q=0;s<this.faces.length;s++,q+=3){var g=this.faces[s];d[q]=g.index1;d[q+1]=g.index2;d[q+2]=g.index3}this.buffers={};this.buffers.array=Gl.createBuffer();this.buffers.index=Gl.createBuffer();Gl.bindBuffer(Gl.ARRAY_BUFFER,this.buffers.array);Gl.bufferData(Gl.ARRAY_BUFFER,e,Gl.STATIC_DRAW);this.buffers.array.length=this.vertexPositions.length*8;Gl.bindBuffer(Gl.ELEMENT_ARRAY_BUFFER,this.buffers.index);Gl.bufferData(Gl.ELEMENT_ARRAY_BUFFER,d,Gl.STATIC_DRAW);this.buffers.index.length=this.faces.length*3}MdxGeoset.prototype={draw:function Mdx(b){var a=b.attributes;Gl.bindBuffer(Gl.ARRAY_BUFFER,this.buffers.array);Gl.vertexAttribPointer(a.in_vertex,3,Gl.FLOAT,false,32,0);Gl.vertexAttribPointer(a.in_normal,3,Gl.FLOAT,false,32,12);Gl.vertexAttribPointer(a.in_texcoord,2,Gl.FLOAT,false,32,24);Gl.bindBuffer(Gl.ELEMENT_ARRAY_BUFFER,this.buffers.index);Gl.drawElements(Gl.TRIANGLES,this.buffers.index.length,Gl.UNSIGNED_SHORT,0)}};function MdxGeosetAnimation(c){var b;this.alpha=c.readUint32();this.flags=c.readFloat32();this.color=c.readFloat32Array(3);this.geosetId=c.readUint32();if(typeof debug!=="undefined"){console.log("\t\talpha = "+this.alpha);console.log("\t\tflags = "+this.flags);console.log("\t\tcolor = "+this.color);console.log("\t\tgeosetId = "+this.geosetId)}for(b=0;b<2;b++){var a=c.read(4);if(a==="KGAO"){if(typeof debug!=="undefined"){console.log("\t\tgeosetAlpha")}this.geosetAlpha=new MdxGeosetAlpha(c)}else{if(a==="KGAC"){if(typeof debug!=="undefined"){console.log("\t\tgeosetColor")}this.geosetColor=new MdxGeosetColor(c)}else{c.skip(-4)}}}}function MdxBone(a){}function MdxLight(a){}function MdxHelper(a){}function MdxAttachment(a){}function MdxPivotPoint(a){this.position=a.readFloat32Array(3)}function MdxParticleEmitter(a){}function MdxParticleEmitter2(a){}function MdxRibbonEmitter(a){}function MdxTrack(a){this.time=a.readUint32()}function MdxEventObject(a){}function MdxCamera(a){}function MdxCollisionShape(a){}function MdxVertexPosition(a){this.position=a.readFloat32Array(3)}function MdxVertexNormal(a){this.normal=a.readFloat32Array(3)}function MdxFaceTypeGroup(a){this.faceType=a.readUint32()}function MdxFaceGroup(a){this.nrOfIndexes=a.readUint32()}function MdxFace(a){this.index1=a.readUint16();this.index2=a.readUint16();this.index3=a.readUint16()}function MdxVertexGroup(a){this.matrixGroup=a.readUint8()}function MdxMatrixGroup(a){this.matrixGroupSize=a.readUint32()}function MdxMatrixIndex(a){this.matrixIndex=a.readUint32()}function MdxExtent(a){this.boundsRadius=a.readFloat32();this.minimumExtent=a.readFloat32Array(3);this.maximumExtent=a.readFloat32Array(3)}function MdxVertexTexturePosition(a){this.texturePosition=a.readFloat32Array(2)}Object.prototype.copy=function(){var a=(this instanceof Array)?[]:{};var b;for(b in this){if(b!=="copy"&&this[b]&&typeof this[b]==="object"){a[b]=this[b].copy()}else{a[b]=this[b]}}return a};var PI=Math.PI;var TWO_PI=2*PI;var HALF_PI=0.5*PI;var PI_OVER_360=PI/360;var DEG_TO_RAD=PI/180;var HALF_DEG_TO_RAD=DEG_TO_RAD/2;var RAD_TO_DEG=180/PI;var Vec3={};var Mat4={};function radians(a){return DEG_TO_RAD*a}Vec3.dot=function(d,c){return(d[0]*c[0])+(d[1]*c[1])+(d[2]*c[2])};Vec3.length=function(b){return Math.sqrt(Vec3.dot(b,b))};Vec3.length2=function(b){return Vec3.dot(b,b)};Vec3.normalize=function(c){var d=new Float32Array(c);var b=Vec3.length2(c);if(0!==b&&1!==b){b=1/Math.sqrt(b);d[0]*=b;d[1]*=b;d[2]*=b}return d};Mat4.identity=function(){return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])};Mat4.multMatrix=function(I,F){var A=new Float32Array(16);var M=I[0],L=I[1],J=I[2],G=I[3];var j=I[4],i=I[5],h=I[6],g=I[7];var z=I[8],y=I[9],x=I[10],w=I[11];var O=I[12],N=I[13],K=I[14],H=I[15];var u=F[0],q=F[1],n=F[2],k=F[3];var E=F[4],D=F[5],C=F[6],B=F[7];var f=F[8],e=F[9],d=F[10],c=F[11];var v=F[12],s=F[13],o=F[14],l=F[15];A[0]=u*M+q*j+n*z+k*O;A[1]=u*L+q*i+n*y+k*N;A[2]=u*J+q*h+n*x+k*K;A[3]=u*G+q*g+n*w+k*H;A[4]=E*M+D*j+C*z+B*O;A[5]=E*L+D*i+C*y+B*N;A[6]=E*J+D*h+C*x+B*K;A[7]=E*G+D*g+C*w+B*H;A[8]=f*M+e*j+d*z+c*O;A[9]=f*L+e*i+d*y+c*N;A[10]=f*J+e*h+d*x+c*K;A[11]=f*G+e*g+d*w+c*H;A[12]=v*M+s*j+o*z+l*O;A[13]=v*L+s*i+o*y+l*N;A[14]=v*J+s*h+o*x+l*K;A[15]=v*G+s*g+o*w+l*H;return A};Mat4.translation=function(a){return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,a[0],a[1],a[2],1])};Mat4.rotation=function(g,f){var b=new Float32Array(16);var a=radians(g);var h=Math.cos(a);var e=Math.sin(a);var d=1-h;f=Vec3.normalize(f);b[0]=d*f[0]*f[0]+h;b[1]=d*f[0]*f[1]-e*f[2];b[2]=d*f[0]*f[1]+e*f[1];b[4]=d*f[0]*f[1]+e*f[2];b[5]=d*f[1]*f[1]+h;b[6]=d*f[1]*f[2]-e*f[0];b[8]=d*f[0]*f[2]-e*f[1];b[9]=d*f[1]*f[2]+e*f[0];b[10]=d*f[2]*f[2]+h;b[15]=1;return b};Mat4.scaling=function(a){return new Float32Array([a[0],0,0,0,0,a[1],0,0,0,0,a[2],0,0,0,0,1])};Mat4.ortho=function(b,j,a,i,g,e){var c=new Float32Array(16);var f=j-b;var d=i-a;var h=e-g;c[0]=2/f;c[5]=2/d;c[10]=-2/h;c[12]=-(j+b)/f;c[13]=-(i+a)/d;c[14]=-(e+g)/h;return c};Mat4.frustum=function(b,j,a,i,g,e){var c=new Float32Array(16);var f=j-b;var d=i-a;var h=e-g;c[0]=(g*2)/f;c[5]=(g*2)/d;c[8]=(j+b)/f;c[9]=(i+a)/d;c[10]=-(e+g)/h;c[11]=-1;c[14]=-(e*g*2)/h;return c};Mat4.perspective=function(b,a,f,d){var c=f*Math.tan(b*PI_OVER_360);var e=c/a;return Mat4.frustum(-c,c,-e,e,f,d)};function BinaryStream(b){var a;this.data=get(b,true);this.buffer=new ArrayBuffer(this.data.length);this.index=0;this.dataview=new DataView(this.buffer);for(a=0;a<this.buffer.byteLength;a++){this.dataview.setUint8(a,this.data.charCodeAt(a))}}BinaryStream.prototype={size:function(){return this.buffer.byteLength},sizeRemaining:function(){return this.buffer.byteLength-this.index},skip:function(a){this.index+=a;if(this.index>this.size()){this.index=this.size()-1;console.log("Exception: clamping illegal internal index")}else{if(this.index<0){this.index=0;console.log("Exception: clamping illegal internal index")}}return this.index},read:function(b){if(this.sizeRemaining()>=b){var c=new Array(b);var a;for(a=0;a<b;a++){c[a]=String.fromCharCode(String(this.dataview.getUint8(this.index+a)))}this.index+=b;return c.join("")}else{console.log("Exception: illegal operation (causes buffer overflow)");return null}},readInt8:function(){if(this.sizeRemaining()>0){var a=this.dataview.getInt8(this.index);this.index+=1;return a}else{console.log("Exception: illegal operation (causes buffer overflow)");return null}},readInt8Array:function(b){if(this.sizeRemaining()>=b){var c=[];var a;for(a=0;a<b;a++){c[a]=this.dataview.getInt8(this.index+a)}this.index+=b;return c}else{console.log("Exception: illegal operation (causes buffer overflow)");return null}},readInt16:function(){if(this.sizeRemaining()>=2){var a=this.dataview.getInt16(this.index,true);this.index+=2;return a}else{console.log("Exception: illegal operation (causes buffer overflow)");return null}},readInt16Array:function(b){if(this.sizeRemaining()>=(b*2)){var c=[];var a;for(a=0;a<b;a++){c[a]=this.dataview.getInt16(this.index+(a*2),true)}this.index+=b*2;return c}else{console.log("Exception: illegal operation (causes buffer overflow)");return null}},readInt32:function(){if(this.sizeRemaining()>=4){var a=this.dataview.getInt32(this.index,true);this.index+=4;return a}else{console.log("Exception: illegal operation (causes buffer overflow)");return null}},readInt32Array:function(b){if(this.sizeRemaining()>=(b*4)){var c=[];var a;for(a=0;a<b;a++){c[a]=this.dataview.getInt32(this.index+(a*4),true)}this.index+=b*4;return c}else{console.log("Exception: illegal operation (causes buffer overflow)");return null}},readUint8:function(){if(this.sizeRemaining()>0){var a=this.dataview.getUint8(this.index);this.index+=1;return a}else{console.log("Exception: illegal operation (causes buffer overflow)");return null}},readUint8Array:function(b){if(this.sizeRemaining()>=b){var c=[];var a;for(a=0;a<b;a++){c[a]=this.dataview.getUint8(this.index+a)}this.index+=b;return c}else{console.log("Exception: illegal operation (causes buffer overflow)");return null}},readUint16:function(){if(this.sizeRemaining()>=2){var a=this.dataview.getUint16(this.index,true);this.index+=2;return a}else{console.log("Exception: illegal operation (causes buffer overflow)");return null}},readUint16Array:function(b){if(this.sizeRemaining()>=(b*2)){var c=[];var a;for(a=0;a<b;a++){c[a]=this.dataview.getUint16(this.index+(a*2),true)}this.index+=b*2;return c}else{console.log("Exception: illegal operation (causes buffer overflow)");return null}},readUint32:function(){if(this.sizeRemaining()>=4){var a=this.dataview.getUint32(this.index,true);this.index+=4;return a}else{console.log("Exception: illegal operation (causes buffer overflow)");return null}},readUint32Array:function(b){if(this.sizeRemaining()>=(b*4)){var c=[];var a;for(a=0;a<b;a++){c[a]=this.dataview.getUint32(this.index+(a*4),true)}this.index+=b*4;return c}else{console.log("Exception: illegal operation (causes buffer overflow)");return null}},readFloat32:function(){if(this.sizeRemaining()>=4){var a=this.dataview.getFloat32(this.index,true);this.index+=4;return a}else{console.log("Exception: illegal operation (causes buffer overflow)");return null}},readFloat32Array:function(b){if(this.sizeRemaining()>=(b*4)){var c=[];var a;for(a=0;a<b;a++){c[a]=this.dataview.getFloat32(this.index+(a*4),true)}this.index+=b*4;return c}else{console.log("Exception: illegal operation (causes buffer overflow)");return null}},readFloat64:function(){if(this.sizeRemaining()>=8){var a=this.dataview.getFloat64(this.index,true);this.index+=8;return a}else{console.log("Exception: illegal operation (causes buffer overflow)");return null}},readFloat64Array:function(b){if(this.sizeRemaining()>=(b*8)){var c=[];var a;for(a=0;a<b;a++){c[a]=this.dataview.getFloat64(this.index+(a*8),true)}this.index+=b*8;return c}else{console.log("Exception: illegal operation (causes buffer overflow)");return null}},readExpected:function(b){if(this.sizeRemaining()>=b.length){var a=this.read(b.length);if(a===b){return true}else{console.log("Exception: expected "+b+" but found "+a);return false}}else{console.log("Exception: illegal operation (causes buffer overflow)");return null}},readHeader:function(){if(this.sizeRemaining()>=8){return new Header(this)}else{return null}}};BinaryParser=function(b,a){this.bigEndian=b,this.allowExceptions=a};with({p:BinaryParser.prototype}){p.encodeFloat=function(a,z,f){var d=Math.pow(2,f-1)-1,c=-d+1,m=d,y=c-z,l=isNaN(k=parseFloat(a))||k==-Infinity||k==+Infinity?k:0,e=0,u=2*d+1+z+3,h=new Array(u),v=(k=l!==0?0:k)<0,k=Math.abs(k),o=Math.floor(k),b=k-o,s,x,w,q,g;for(s=u;s;h[--s]=0){}for(s=d+2;o&&s;h[--s]=o%2,o=Math.floor(o/2)){}for(s=d+1;b>0&&s;(h[++s]=((b*=2)>=1)-0)&&--b){}for(s=-1;++s<u&&!h[s];){}if(h[(x=z-1+(s=(e=d+1-s)>=c&&e<=m?s+1:d+1-(e=c-1)))+1]){if(!(w=h[x])){for(q=x+2;!w&&q<u;w=h[q++]){}}for(q=x+1;w&&--q>=0;(h[q]=!h[q]-0)&&(w=0)){}}for(s=s-2<0?-1:s-3;++s<u&&!h[s];){}(e=d+1-s)>=c&&e<=m?++s:e<c&&(e!=d+1-u&&e<y&&this.warn("encodeFloat::float underflow"),s=d+1-(e=c-1));(o||l!==0)&&(this.warn(o?"encodeFloat::float overflow":"encodeFloat::"+l),e=m+1,s=d+2,l==-Infinity?v=1:isNaN(l)&&(h[s]=1));for(k=Math.abs(e+d),q=f+1,g="";--q;g=(k%2)+g,k=k>>=1){}for(k=0,q=0,s=(g=(v?"1":"0")+g+h.slice(s,s+z).join("")).length,r=[];s;k+=(1<<q)*g.charAt(--s),q==7&&(r[r.length]=String.fromCharCode(k),k=0),q=(q+1)%8){}r[r.length]=k?String.fromCharCode(k):"";return(this.bigEndian?r.reverse():r).join("")};p.encodeInt=function(d,e,b){var a=Math.pow(2,e),c=[];(d>=a||d<-(a>>1))&&this.warn("encodeInt::overflow")&&(d=0);d<0&&(d+=a);for(;d;c[c.length]=String.fromCharCode(d%256),d=Math.floor(d/256)){}for(e=-(-e>>3)-c.length;e--;c[c.length]="\0"){}return(this.bigEndian?c.reverse():c).join("")};p.decodeFloat=function(f,c,n){var l=((l=new this.Buffer(this.bigEndian,f)).checkBuffer(c+n+1),l),g=Math.pow(2,n-1)-1,j=l.readBits(c+n,1),k=l.readBits(c,n),i=0,d=2,a=l.buffer.length+(-c>>3)-1,e,h,m;do{for(e=l.buffer[++a],h=c%8||8,m=1<<h;m>>=1;(e&m)&&(i+=1/d),d*=2){}}while(c-=h);return k==(g<<1)+1?i?NaN:j?-Infinity:+Infinity:(1+j*-2)*(k||i?!k?Math.pow(2,-g+1)*i:Math.pow(2,k-g)*(1+i):0)};p.decodeInt=function(g,f,e){var d=new this.Buffer(this.bigEndian,g),c=d.readBits(0,f),a=Math.pow(2,f);return e&&c>=a/2?c-a:c};with({p:(p.Buffer=function(b,a){this.bigEndian=b||0,this.buffer=[],this.setBuffer(a)}).prototype}){p.readBits=function(b,d){function c(k,j){for(++j;--j;k=((k%=2147483647+1)&1073741824)==1073741824?k*2:(k-1073741824)*2+2147483647+1){}return k}if(b<0||d<=0){return 0}this.checkBuffer(b+d);for(var e,f=b%8,a=this.buffer.length-(b>>3)-1,i=this.buffer.length+(-(b+d)>>3),h=a-i,g=((this.buffer[a]>>f)&((1<<(h?8-f:d))-1))+(h&&(e=(b+d)%8)?(this.buffer[i++]&((1<<e)-1))<<(h--<<3)-f:0);h;g+=c(this.buffer[i++],(h--<<3)-f)){}return g};p.setBuffer=function(e){if(e){for(var c,d=c=e.length,a=this.buffer=new Array(c);d;a[c-d]=e.charCodeAt(--d)){}this.bigEndian&&a.reverse()}};p.hasNeededBits=function(a){return this.buffer.length>=-(-a>>3)};p.checkBuffer=function(a){if(!this.hasNeededBits(a)){throw new Error("checkBuffer::missing bytes")}}}p.warn=function(a){if(this.allowExceptions){throw new Error(a)}return 1};p.toSmall=function(a){return this.decodeInt(a,8,true)};p.fromSmall=function(a){return this.encodeInt(a,8,true)};p.toByte=function(a){return this.decodeInt(a,8,false)};p.fromByte=function(a){return this.encodeInt(a,8,false)};p.toShort=function(a){return this.decodeInt(a,16,true)};p.fromShort=function(a){return this.encodeInt(a,16,true)};p.toWord=function(a){return this.decodeInt(a,16,false)};p.fromWord=function(a){return this.encodeInt(a,16,false)};p.toInt=function(a){return this.decodeInt(a,32,true)};p.fromInt=function(a){return this.encodeInt(a,32,true)};p.toDWord=function(a){return this.decodeInt(a,32,false)};p.fromDWord=function(a){return this.encodeInt(a,32,false)};p.toFloat=function(a){return this.decodeFloat(a,23,8)};p.fromFloat=function(a){return this.encodeFloat(a,23,8)};p.toDouble=function(a){return this.decodeFloat(a,52,11)};p.fromDouble=function(a){return this.encodeFloat(a,52,11)}}var haveDataView=(typeof window.DataView==="undefined")?false:true;function BinaryStream(b){this.data=get(b,true);if(haveDataView){this.buffer=new ArrayBuffer(this.data.length);this.dataview=new DataView(this.buffer);for(var a=0;a<this.buffer.byteLength;a++){this.dataview.setUint8(a,this.data.charCodeAt(a))}}else{for(var a=0;a<this.data.length;a++){this.data[a]=this.data.charCodeAt(a)&255}this.parser=new BinaryParser();this.sub=function(d,c){return this.data.substring(d,d+c)}}this.index=0}BinaryStream.prototype={size:function(){if(haveDataView){return this.buffer.byteLength}else{return this.data.length}},sizeRemaining:function(){if(haveDataView){return this.buffer.byteLength-this.index}else{return this.data.length-this.index}},skip:function(a){this.index+=a;if(this.index>this.size()){this.index=this.size()-1;console.log("Exception: clamping illegal internal index")}else{if(this.index<0){this.index=0;console.log("Exception: clamping illegal internal index")}}return this.index},read:function(b){if(this.sizeRemaining()>=b){var c=Array(b);for(var a=0;a<b;a++){if(haveDataView){c[a]=String.fromCharCode(String(this.dataview.getUint8(this.index+a)))}else{c[a]=String.fromCharCode(this.parser.decodeInt(this.sub(this.index+a,1),8,false))}}this.index+=b;return c.join("")}else{console.log("Exception: illegal operation (causes buffer overflow)");return null}},readInt8:function(){if(this.sizeRemaining()>0){if(haveDataView){var a=this.dataview.getInt8(this.index)}else{var a=this.parser.decodeInt(this.sub(this.index,1),8,true)}this.index+=1;return a}else{console.log("Exception: illegal operation (causes buffer overflow)");return null}},readInt8Array:function(b){if(this.sizeRemaining()>=b){var c=[];for(var a=0;a<b;a++){if(haveDataView){c[a]=this.dataview.getInt8(this.index)}else{c[a]=this.parser.decodeInt(this.sub(this.index,1),8,true)}this.index+=1}return c}else{console.log("Exception: illegal operation (causes buffer overflow)");return null}},readInt16:function(){if(this.sizeRemaining()>=2){if(haveDataView){var a=this.dataview.getInt16(this.index,true)}else{var a=this.parser.decodeInt(this.sub(this.index,2),16,true)}this.index+=2;return a}else{console.log("Exception: illegal operation (causes buffer overflow)");return null}},readInt16Array:function(b){if(this.sizeRemaining()>=(b*2)){var c=[];for(var a=0;a<b;a++){if(haveDataView){c[a]=this.dataview.getInt16(this.index+(a*2),true)}else{c[a]=this.parser.decodeInt(this.sub(this.index+(a*2),2),16,true)}}this.index+=b*2;return c}else{console.log("Exception: illegal operation (causes buffer overflow)");return null}},readInt32:function(){if(this.sizeRemaining()>=4){if(haveDataView){var a=this.dataview.getInt32(this.index,true)}else{var a=this.parser.decodeInt(this.sub(this.index,4),32,true)}this.index+=4;return a}else{console.log("Exception: illegal operation (causes buffer overflow)");return null}},readInt32Array:function(b){if(this.sizeRemaining()>=(b*4)){var c=[];for(var a=0;a<b;a++){if(haveDataView){c[a]=this.dataview.getInt32(this.index+(a*4),true)}else{c[a]=this.parser.decodeInt(this.sub(this.index+(a*4),4),32,true)}}this.index+=b*4;return c}else{console.log("Exception: illegal operation (causes buffer overflow)");return null}},readUint8:function(){if(this.sizeRemaining()>0){if(haveDataView){var a=this.dataview.getUint8(this.index)}else{var a=this.parser.decodeInt(this.sub(this.index,1),8,false)}this.index+=1;return a}else{console.log("Exception: illegal operation (causes buffer overflow)");return null}},readUint8Array:function(b){if(this.sizeRemaining()>=b){var c=[];for(var a=0;a<b;a++){if(haveDataView){c[a]=this.dataview.getUint8(this.index+a)}else{c[a]=this.parser.decodeInt(this.sub(this.index+a,1),8,false)}}this.index+=b;return c}else{console.log("Exception: illegal operation (causes buffer overflow)");return null}},readUint16:function(){if(this.sizeRemaining()>=2){if(haveDataView){var a=this.dataview.getUint16(this.index,true)}else{var a=this.parser.decodeInt(this.sub(this.index,2),16,false)}this.index+=2;return a}else{console.log("Exception: illegal operation (causes buffer overflow)");return null}},readUint16Array:function(b){if(this.sizeRemaining()>=(b*2)){var c=[];for(var a=0;a<b;a++){if(haveDataView){c[a]=this.dataview.getUint16(this.index+(a*2),true)}else{c[a]=this.parser.decodeInt(this.sub(this.index+(a*2),2),16,false)}}this.index+=b*2;return c}else{console.log("Exception: illegal operation (causes buffer overflow)");return null}},readUint32:function(){if(this.sizeRemaining()>=4){if(haveDataView){var a=this.dataview.getUint32(this.index,true)}else{var a=this.parser.decodeInt(this.sub(this.index,4),32,false)}this.index+=4;return a}else{console.log("Exception: illegal operation (causes buffer overflow)");return null}},readUint32Special:function(){if(this.sizeRemaining()>=4){if(haveDataView){var a=this.dataview.getUint32(this.index,true)}else{var a=this.parser.toByte(this.sub(this.index,4));var b=this.parser.toByte(this.sub(this.index+1,4));console.log(this.sub(this.index,4)+" === "+a+" === "+b);var a=this.parser.toDWord(this.sub(this.index,4))}this.index+=4;return a}else{console.log("Exception: illegal operation (causes buffer overflow)");return null}},readUint32Array:function(b){if(this.sizeRemaining()>=(b*4)){var c=[];for(var a=0;a<b;a++){if(haveDataView){c[a]=this.dataview.getUint32(this.index+(a*4),true)}else{c[a]=this.parser.decodeInt(this.sub(this.index+(a*4),4),32,false)}}this.index+=b*4;return c}else{console.log("Exception: illegal operation (causes buffer overflow)");return null}},readFloat32:function(){if(this.sizeRemaining()>=4){if(haveDataView){var a=this.dataview.getFloat32(this.index,true)}else{var a=this.parser.decodeFloat(this.sub(this.index,4),23,8,false)}this.index+=4;return a}else{console.log("Exception: illegal operation (causes buffer overflow)");return null}},readFloat32Array:function(b){if(this.sizeRemaining()>=(b*4)){var c=[];for(var a=0;a<b;a++){if(haveDataView){c[a]=this.dataview.getFloat32(this.index+(a*4),true)}else{var c=this.parser.decodeFloat(this.sub(this.index+(a*4),4),23,8,false)}}this.index+=b*4;return c}else{console.log("Exception: illegal operation (causes buffer overflow)");return null}},readFloat64:function(){if(this.sizeRemaining()>=8){if(haveDataView){var a=this.dataview.getFloat64(this.index,true)}else{var a=this.parser.decodeFloat(this.sub(this.index,8),52,11,false)}this.index+=8;return a}else{console.log("Exception: illegal operation (causes buffer overflow)");return null}},readFloat64Array:function(b){if(this.sizeRemaining()>=(b*8)){var c=[];for(var a=0;a<b;a++){if(haveDataView){c[a]=this.dataview.getFloat64(this.index+(a*8),true)}else{c[a]=this.parser.decodeFloat(this.sub(this.index+(a*8),8),52,11,false)}}this.index+=b*8;return c}else{console.log("Exception: illegal operation (causes buffer overflow)");return null}},readExpected:function(b){if(this.sizeRemaining()>=b.length){var a=this.read(b.length);if(a===b){return true}else{console.log("Exception: expected "+b+" but found "+a);return false}}else{console.log("Exception: illegal operation (causes buffer overflow)");return null}},readHeader:function(){if(this.sizeRemaining()>=8){return new Header(this)}else{return null}}};function get(a,d){var b=new XMLHttpRequest();var c;b.onreadystatechange=function(){if(b.readyState===4){if(b.status===200){c=b.responseText;console.log("sync loaded "+a+" ("+c.length+" bytes)")}else{console.log("sync failed to load "+a)}}};b.open("GET",a,false);if(d===true){b.overrideMimeType("text/plain; charset=x-user-defined")}b.send("");return c}function getA(a,d){var b=new XMLHttpRequest();var c;b.onreadystatechange=function(){if(b.readyState===4){if(b.status===200){c=b.responseText;console.log("async loaded "+a+" ("+c.length+" bytes)")}else{console.log("async failed to load "+a)}}};b.open("GET",a,true);if(d===true){b.overrideMimeType("text/plain; charset=x-user-defined")}b.send("");return c}function GlState(){this.shaders={};this.programs=[];this.currentProgram=null;this.projectionMatrix=Mat4.identity();this.modelviewMatrix=Mat4.identity();this.textures=[];this.currentTexture={}}GlState.prototype={getShader:function(a,b){if(this.shaders[a]!==undefined){return this.shaders[a]}else{var c=new Shader(a,b);this.shaders[a]=c;return c}},createProgram:function(a,c){var b=new Program(a,c);return b},useProgram:function(b){var a;var d;var c;if(this.currentProgram!==null){a=this.currentProgram.attributes;d=Object.keys(a);for(c=0;c<d.length;c++){Gl.disableVertexAttribArray(a[d[c]])}}this.currentProgram=b;Gl.useProgram(b.id);a=this.currentProgram.attributes;d=Object.keys(a);for(c=0;c<d.length;c++){Gl.enableVertexAttribArray(a[d[c]])}},usedProgram:function(){return this.currentProgram},bindProjection:function(a){Gl.uniformMatrix4fv(this.currentProgram.uniforms[a],Gl.FALSE,this.projectionMatrix)},bindModelview:function(a){Gl.uniformMatrix4fv(this.currentProgram.uniforms[a],Gl.FALSE,this.modelviewMatrix)},bindTransform:function(a){Gl.uniformMatrix4fv(this.currentProgram.uniforms[a],Gl.FALSE,Mat4.multMatrix(this.projectionMatrix,this.modelviewMatrix))},ortho:function(f,c,b,e,d,a){this.projectionMatrix=Mat4.ortho(f,c,b,e,d,a)},perspective:function(b,a,d,c){this.projectionMatrix=Mat4.perspective(b,a,d,c)},translate:function(a){this.modelviewMatrix=Mat4.multMatrix(this.modelviewMatrix,Mat4.translation(a))},rotate:function(b,a){this.modelviewMatrix=Mat4.multMatrix(this.modelviewMatrix,Mat4.rotation(b,a))},scale:function(a){this.modelviewMatrix=Mat4.multMatrix(this.modelviewMatrix,Mat4.scaling(a))},loadIdentity:function(){this.modelviewMatrix=Mat4.identity()},pushMatrix:function(){this.matrixStack.push(this.modelviewMatrix.copy())},popMatrix:function(){this.modelviewMatrix=this.matrixStack.pop()},getTexture:function(a){if(this.textures[a]){return this.textures[a]}else{var b=new Texture(a);this.textures[a]=b;return b}},bindTexture:function(b,a){this.currentTexture[b]=a;Gl.activeTexture(b);Gl.bindTexture(Gl.TEXTURE_2D,a.id)},boundTexture:function(a){return this.currentTexture[a]}};function Shader(a,b){this.file=a;this.type=b;this.source=get(a);this.id=Gl.createShader(b);console.log("registering shader object "+this.id);Gl.shaderSource(this.id,this.source);Gl.compileShader(this.id)}Shader.prototype={getParameter:function(a){return Gl.getShaderParameter(this.id,a)},getInfoLog:function(){return Gl.getShaderInfoLog(this.id)}};function Program(h,c){var j=Gl.state.getShader(h,Gl.VERTEX_SHADER);var e=Gl.state.getShader(c,Gl.FRAGMENT_SHADER);var f;var g;var d;if(j.getParameter(Gl.COMPILE_STATUS)&&e.getParameter(Gl.COMPILE_STATUS)){this.id=Gl.createProgram();Gl.attachShader(this.id,j.id);Gl.attachShader(this.id,e.id);Gl.linkProgram(this.id);if(Gl.getProgramParameter(this.id,Gl.LINK_STATUS)===true){this.uniforms={};this.attributes={};f=Gl.getProgramParameter(this.id,Gl.ACTIVE_UNIFORMS);for(d=0;d<f;d++){var a=Gl.getActiveUniform(this.id,d);g=Gl.getUniformLocation(this.id,a.name);this.uniforms[a.name]=g}f=Gl.getProgramParameter(this.id,Gl.ACTIVE_ATTRIBUTES);for(d=0;d<f;d++){var b=Gl.getActiveAttrib(this.id,d);g=Gl.getAttribLocation(this.id,b.name);this.attributes[b.name]=g}}else{console.log("Error: the program object failed to link")}}else{console.log("Error: one or both of the shaders failed to compile")}}Program.prototype={uniform1i:function(b,a){Gl.uniform1i(this.uniforms[b],a)}};function Texture(a){this.file=a;this.id=Gl.createTexture();this.image=new Image();this.image.src=a;var a=this.file;var b=this.id;this.image.onload=function(){Gl.bindTexture(Gl.TEXTURE_2D,b);Gl.texImage2D(Gl.TEXTURE_2D,0,Gl.RGBA,Gl.RGBA,Gl.UNSIGNED_BYTE,this);Gl.texParameteri(Gl.TEXTURE_2D,Gl.TEXTURE_MAG_FILTER,Gl.LINEAR);Gl.texParameteri(Gl.TEXTURE_2D,Gl.TEXTURE_MIN_FILTER,Gl.LINEAR_MIPMAP_NEAREST);Gl.generateMipmap(Gl.TEXTURE_2D);console.log("loaded image "+a)}}Texture.prototype={};function Header(a){this.token=a.read(4);this.size=a.readUint32()}function MdxGeosetTranslation(a){}function MdxGeosetRotation(a){}function MdxGeosetScaling(a){}function MdxGeosetAlpha(c){var b=c.readUint32();var a;this.interpolationType=c.readUint32();this.globalSequenceId=c.readUint32();this.alphaTracks=new Array(b);for(a=0;a<b;a++){this.alphaTracks[a]=new MdxAlphaTrack(c,this.interpolationType)}if(typeof debug!=="undefined"){console.log("\t\t\tinterpolationType = "+this.interpolationType);console.log("\t\t\tglobalSequenceId = "+this.globalSequenceId);console.log("\t\t\talphaTracks = "+this.alphaTracks.length+" [...]")}}function MdxGeosetColor(c){var b=c.readUint32();var a;this.interpolationType=c.readUint32();this.globalSequenceId=c.readUint32();this.colorTracks=new Array(b);for(a=0;a<b;a++){this.colorTracks[a]=new MdxColorTrack(c,this.interpolationType)}if(typeof debug!=="undefined"){console.log("\t\t\tinterpolationType = "+this.interpolationType);console.log("\t\t\tglobalSequenceId = "+this.globalSequenceId);console.log("\t\t\tcolorTracks = "+this.colorTracks.length+" [...]")}}function MdxTextureTranslation(a){}function MdxTextureRotation(a){}function MdxTextureScaling(a){}function MdxCameraPositionTranslation(a){}function MdxCameraTargetTranslation(a){}function MdxCameraRotation(a){}function MdxMaterialTextureId(c){var b=c.readUint32();var a;this.interpolationType=c.readUint32();this.globalSequenceId=c.readUint32();this.textureIdTracks=new Array(b);for(a=0;a<b;a++){this.textureIdTracks[a]=new MdxTextureIdTrack(c,this.interpolationType)}if(typeof debug!=="undefined"){console.log("\t\t\t\t\tinterpolationType = "+this.interpolationType);console.log("\t\t\t\t\tglobalSequenceId = "+this.globalSequenceId);console.log("\t\t\t\t\ttextureIdTracks = "+this.textureIdTracks.length+" [...]")}}function MdxMaterialAlpha(c){var b=c.readUint32();var a;this.interpolationType=c.readUint32();this.globalSequenceId=c.readUint32();this.alphaTracks=new Array(b);for(a=0;a<b;a++){this.alphaTracks[a]=new MdxAlphaTrack(c,this.interpolationType)}if(typeof debug!=="undefined"){console.log("\t\t\t\t\tinterpolationType = "+this.interpolationType);console.log("\t\t\t\t\tglobalSequenceId = "+this.globalSequenceId);console.log("\t\t\t\t\talphaTracks = "+this.alphaTracks.length+" [...]")}}function MdxAttachmentVisibility(a){}function MdxLightVisibility(a){}function MdxLightColor(a){}function MdxLightIntensity(a){}function MdxLightAmbientColor(a){}function MdxLightAmbientIntensity(a){}function MdxParticleEmitterVisibility(a){}function MdxParticleEmitter2Visibility(a){}function MdxParticleEmitter2EmissionRate(a){}function MdxParticleEmitter2Width(a){}function MdxParticleEmitter2Length(a){}function MdxParticleEmitter2Speed(a){}function MdxRibbonEmitterVisibility(a){}function MdxRibbonEmitterHeightAbove(a){}function MdxRibbonEmitterHeightBelow(a){}function MdxNode(a){}function MdxVersionChunk(b,a){log("VersionChunk...");this.version=b.readUint32();if(typeof debug!=="undefined"){console.log("\tversion = "+this.version)}log("OK")}function MdxModelChunk(b,a){log("ModelChunk...");this.name=b.read(80);this.animationFileName=b.read(260);this.boundsRadius=b.readFloat32();this.minimumExtent=b.readFloat32Array(3);this.maximumExtent=b.readFloat32Array(3);this.blendTime=b.readUint32();if(typeof debug!=="undefined"){console.log("\tname = "+this.name);console.log("\tanimationFileName = "+this.animationFileName);console.log("\tboundsRadius = "+this.boundsRadius);console.log("\tminimumExtent = "+this.minimumExtent);console.log("\tmaximumExtent = "+this.maximumExtent);console.log("\tblendTime = "+this.blendTime)}log("OK")}function MdxSequenceChunk(d,c){log("SequenceChunk...");var a=c/132;var b;this.sequences=new Array(a);for(b=0;b<a;b++){if(typeof debug!=="undefined"){console.log("\tsequence "+b)}this.sequences[b]=new MdxSequence(d)}log("OK")}function MdxGlobalSequenceChunk(d,c){log("GlobalSequenceChunk...");var a=c/4;var b;this.globalSequences=new Array(a);for(b=0;b<a;b++){if(typeof debug!=="undefined"){console.log("\tglobal sequence "+b)}this.globalSequences[b]=new MdxGlobalSequence(d)}log("OK")}function MdxTextureChunk(d,c){log("TextureChunk...");var a=c/268;var b;this.textures=new Array(a);for(b=0;b<a;b++){if(typeof debug!=="undefined"){console.log("\ttexture "+b)}this.textures[b]=new MdxTexture(d)}log("OK")}function MdxLayerChunk(d,c){var a=d.readUint32();var b;this.layers=new Array(a);for(b=0;b<a;b++){if(typeof debug!=="undefined"){console.log("\t\t\tlayer "+b)}this.layers[b]=new MdxLayer(d)}}function MdxMaterialChunk(d,b){log("MaterialChunk...");var c=0;var a=0;this.materials=[];while(a!==b){c=d.readUint32();a+=c;if(typeof debug!=="undefined"){console.log("\tmaterial "+this.materials.length)}this.materials.push(new MdxMaterial(d))}log("OK")}function MdxTextureAnimationChunk(b,a){console.log("TextureAnimationChunk...");b.skip(a);console.log("Oops, not impelemented yet")}function MdxGeosetChunk(d,b){log("GeosetChunk...");var c=0;var a=0;this.geosets=[];while(a!==b){c=d.readUint32();a+=c;if(typeof debug!=="undefined"){console.log("\tgeoset "+this.geosets.length)}this.geosets[this.geosets.length]=new MdxGeoset(d)}log("OK")}function MdxGeosetAnimationChunk(d,b){log("GeosetAnimationChunk...");var c=0;var a=0;this.geosetAnimations=[];while(a!==b){c=d.readUint32();a+=c;if(typeof debug!=="undefined"){console.log("\tgeosetAnimation "+this.geosetAnimations.length)}this.geosetAnimations[this.geosetAnimations.length]=new MdxGeosetAnimation(d)}log("OK")}function MdxBoneChunk(b,a){log("BoneChunk...");b.skip(a);log("Oops, not impelemented yet")}function MdxLightChunk(b,a){log("LightChunk...");b.skip(a);log("Oops, not impelemented yet")}function MdxHelperChunk(b,a){log("HelperChunk...");b.skip(a);log("Oops, not impelemented yet")}function MdxAttachmentChunk(b,a){log("AttachmentChunk...");b.skip(a);log("Oops, not impelemented yet")}function MdxPivotPointChunk(b,a){log("PivotPointChunk...");b.skip(a);log("Oops, not impelemented yet")}function MdxParticleEmitterChunk(b,a){log("ParticleEmitterChunk...");b.skip(a);log("Oops, not impelemented yet")}function MdxParticleEmitter2Chunk(b,a){log("ParticleEmitter2Chunk...");b.skip(a);log("Oops, not impelemented yet")}function MdxRibbonEmitterChunk(b,a){log("RibbonEmitterChunk...");b.skip(a);log("Oops, not impelemented yet")}function MdxTracks(b,a){}function MdxEventObjectChunk(b,a){log("EventObjectChunk...");b.skip(a);log("Oops, not impelemented yet")}function MdxCameraChunk(b,a){log("CameraChunk...");b.skip(a);log("Oops, not impelemented yet")}function MdxCollisionShapeChunk(b,a){log("CollisionShapeChunk...");b.skip(a);log("Oops, not impelemented yet")}function MdxTranslationTrack(a,b){this.time=a.readUint32();this.translation=a.readFloat32Array(3);if(b>1){this.inTan=a.readFloat32Array(3);this.outTan=a.readFloat32Array(3)}}function MdxRotationTrack(a,b){this.time=a.readUint32();this.rotation=a.readFloat32Array(4);if(b>1){this.inTan=a.readFloat32Array(4);this.outTan=a.readFloat32Array(4)}}function MdxScalingTrack(a,b){this.time=a.readUint32();this.scalling=a.readFloat32Array(3);if(b>1){this.inTan=a.readFloat32Array(3);this.outTan=a.readFloat32Array(3)}}function MdxAlphaTrack(a,b){this.time=a.readUint32();this.alpha=a.readFloat32();if(b>1){this.inTan=a.readFloat32();this.outTan=a.readFloat32()}}function MdxTextureIdTrack(a,b){this.time=a.readUint32();this.textureId=a.readUint32();if(b>1){this.inTan=a.readFloat32();this.outTan=a.readFloat32()}}function MdxColorTrack(a,b){this.time=a.readUint32();this.color=a.readFloat32Array(3);if(b>1){this.inTan=a.readFloat32Array(3);this.outTan=a.readFloat32Array(3)}}function MdxSequence(b){var a=b.read(80);this.name=a.substring(0,a.indexOf("\0"));this.intervalStart=b.readUint32();this.intervalEnd=b.readUint32();this.moveSpeed=b.readFloat32();this.flags=b.readUint32();this.rarity=b.readFloat32();this.syncPoint=b.readUint32();this.boundsRadius=b.readFloat32();this.minimumExtent=b.readFloat32Array(3);this.maximumExtent=b.readFloat32Array(3);if(typeof debug!=="undefined"){console.log("\t\tname = "+this.name);console.log("\t\tintervalStart = "+this.intervalStart);console.log("\t\tintervalEnd = "+this.intervalEnd);console.log("\t\tmoveSpeed = "+this.moveSpeed);console.log("\t\tflags = "+this.flags);console.log("\t\trarity = "+this.rarity);console.log("\t\tsyncPoint = "+this.syncPoint);console.log("\t\tboundsRadius = "+this.boundsRadius);console.log("\t\tminimumExtent = "+this.minimumExtent);console.log("\t\tmaximumExtent = "+this.maximumExtent)}}function MdxGlobalSequence(a){this.duration=a.readUint32();if(typeof debug!=="undefined"){console.log("\t\tduration = "+this.duration)}}function MdxTexture(a){this.replaceableId=a.readUint32();var b=a.read(260);this.fileName=b.substring(0,b.indexOf("\0")).replace(/\\/g,"/");this.flags=a.readUint32();if(typeof debug!=="undefined"){console.log("\t\treplaceableId = "+this.replaceableId);console.log("\t\tfileName = "+this.fileName);console.log("\t\tflags = "+this.flags)}if(this.fileName!==""){this.httpName=this.fileName.substring(0,this.fileName.lastIndexOf("."))+".png";this.texture=Gl.state.getTexture(this.httpName)}}function MdxLayer(d){var c=d.readUint32();var b;this.filterMode=d.readUint32();this.shadingFlags=d.readUint32();console.log(d.index);this.textureId=d.readUint32();console.log(this.textureId);this.textureAnimationId=d.readUint32();this.coordId=d.readUint32();this.alpha=d.readFloat32();if(typeof debug!=="undefined"){console.log("\t\t\t\tfilterMode = "+this.filterMode);console.log("\t\t\t\tshadingFlags = "+this.shadingFlags);console.log("\t\t\t\ttextureId = "+this.textureId);console.log("\t\t\t\ttextureAnimationId = "+this.textureAnimationId);console.log("\t\t\t\tcoordId = "+this.coordId);console.log("\t\t\t\talpha = "+this.alpha)}if(c>28){for(b=0;b<2;b++){var a=d.read(4);if(a==="KMTA"){if(typeof debug!=="undefined"){console.log("\t\t\t\tmaterialAlpha")}this.materialAlpha=new MdxMaterialAlpha(d)}else{if(a==="KMTF"){if(typeof debug!=="undefined"){console.log("\t\t\t\tmaterialTextureId")}this.materialTextureId=new MdxMaterialTextureId(d)}else{d.skip(-4)}}}}}function MdxMaterial(b){this.priorityPlane=b.readUint32();this.flags=b.readUint32();var a=b.read(4);if(typeof debug!=="undefined"){console.log("\t\tpriorityPlane = "+this.priorityPlane);console.log("\t\tflags = "+this.flags)}if(a==="LAYS"){if(typeof debug!=="undefined"){console.log("\t\tlayerChunk")}this.layerChunk=new MdxLayerChunk(b)}else{b.skip(-4)}}function MdxTextureAnimation(a){}function MdxGeoset(c){c.readExpected("VRTX");var o=c.readUint32();var s;var q;this.vertexPositions=new Array(o);for(s=0;s<o;s++){this.vertexPositions[s]=new MdxVertexPosition(c)}c.readExpected("NRMS");var n=c.readUint32();this.vertexNormals=new Array(n);for(s=0;s<n;s++){this.vertexNormals[s]=new MdxVertexNormal(c)}c.readExpected("PTYP");var v=c.readUint32();this.faceTypeGroups=new Array(v);for(s=0;s<v;s++){this.faceTypeGroups[s]=new MdxFaceTypeGroup(c)}c.readExpected("PCNT");var u=c.readUint32();this.faceGroups=new Array(u);for(s=0;s<u;s++){this.faceGroups[s]=new MdxFaceGroup(c)}c.readExpected("PVTX");var b=c.readUint32();var f=b/3;this.faces=new Array(f);for(s=0;s<f;s++){this.faces[s]=new MdxFace(c)}c.readExpected("GNDX");var w=c.readUint32();this.vertexGroups=new Array(w);for(s=0;s<w;s++){this.vertexGroups[s]=new MdxVertexGroup(c)}c.readExpected("MTGC");var h=c.readUint32();this.matrixGroups=new Array(h);for(s=0;s<h;s++){this.matrixGroups[s]=new MdxMatrixGroup(c)}c.readExpected("MATS");var l=c.readUint32();this.matrixIndexes=new Array(l);for(s=0;s<l;s++){this.matrixIndexes[s]=new MdxMatrixIndex(c)}this.materialId=c.readUint32();this.selectionGroup=c.readUint32();this.selectionFlags=c.readUint32();this.boundsRadius=c.readFloat32();this.minimumExtent=c.readFloat32Array(3);this.maximumExtent=c.readFloat32Array(3);var a=c.readUint32();this.extents=new Array(a);for(s=0;s<a;s++){this.extents[s]=new MdxExtent(c)}c.readExpected("UVAS");var m=c.readUint32();c.readExpected("UVBS");var k=c.readUint32();this.vertexTexturePositions=new Array(k);for(s=0;s<k;s++){this.vertexTexturePositions[s]=new MdxVertexTexturePosition(c)}if(typeof debug!=="undefined"){console.log("\t\tvertexPositions = "+this.vertexPositions.length+" [...]");console.log("\t\tvertexNormals = "+this.vertexNormals.length+" [...]");console.log("\t\tfaceTypeGroups = "+this.faceTypeGroups.length+" [...]");console.log("\t\tfaceGroups = "+this.faceGroups.length+" [...]");console.log("\t\tfaces = "+this.faces.length+" [...]");console.log("\t\tvertexGroups = "+this.vertexGroups.length+" [...]");console.log("\t\tmatrixGroups = "+this.matrixGroups.length+" [...]");console.log("\t\tmatrixIndexes = "+this.matrixIndexes.length+" [...]");console.log("\t\tmaterialId = "+this.materialId);console.log("\t\tselectionGroup = "+this.selectionGroup);console.log("\t\tselectionFlags = "+this.selectionFlags);console.log("\t\tboundsRadius = "+this.boundsRadius);console.log("\t\tminimumExtent = "+this.minimumExtent);console.log("\t\tmaximumExtent = "+this.maximumExtent);console.log("\t\textents = "+this.extents.length+" [...]");console.log("\t\tvertexTexturePositions = "+this.vertexTexturePositions.length+" [...]")}var e=new Float32Array(this.vertexPositions.length*8);var d=new Uint16Array(this.faces.length*3);for(s=0,q=0;s<this.vertexPositions.length;s++,q+=8){var z=this.vertexPositions[s].position;var y=this.vertexNormals[s].normal;var x=this.vertexTexturePositions[s].texturePosition;e[q]=z[0];e[q+1]=z[1];e[q+2]=z[2];e[q+3]=y[0];e[q+4]=y[1];e[q+5]=y[2];e[q+6]=x[0];e[q+7]=x[1]}for(s=0,q=0;s<this.faces.length;s++,q+=3){var g=this.faces[s];d[q]=g.index1;d[q+1]=g.index2;d[q+2]=g.index3}this.buffers={};this.buffers.array=Gl.createBuffer();this.buffers.index=Gl.createBuffer();Gl.bindBuffer(Gl.ARRAY_BUFFER,this.buffers.array);Gl.bufferData(Gl.ARRAY_BUFFER,e,Gl.STATIC_DRAW);this.buffers.array.length=this.vertexPositions.length*8;Gl.bindBuffer(Gl.ELEMENT_ARRAY_BUFFER,this.buffers.index);Gl.bufferData(Gl.ELEMENT_ARRAY_BUFFER,d,Gl.STATIC_DRAW);this.buffers.index.length=this.faces.length*3}MdxGeoset.prototype={draw:function Mdx(b){var a=b.attributes;Gl.bindBuffer(Gl.ARRAY_BUFFER,this.buffers.array);Gl.vertexAttribPointer(a.in_vertex,3,Gl.FLOAT,false,32,0);Gl.vertexAttribPointer(a.in_normal,3,Gl.FLOAT,false,32,12);Gl.vertexAttribPointer(a.in_texcoord,2,Gl.FLOAT,false,32,24);Gl.bindBuffer(Gl.ELEMENT_ARRAY_BUFFER,this.buffers.index);Gl.drawElements(Gl.TRIANGLES,this.buffers.index.length,Gl.UNSIGNED_SHORT,0)}};function MdxGeosetAnimation(c){var b;this.alpha=c.readUint32();this.flags=c.readFloat32();this.color=c.readFloat32Array(3);this.geosetId=c.readUint32();if(typeof debug!=="undefined"){console.log("\t\talpha = "+this.alpha);console.log("\t\tflags = "+this.flags);console.log("\t\tcolor = "+this.color);console.log("\t\tgeosetId = "+this.geosetId)}for(b=0;b<2;b++){var a=c.read(4);if(a==="KGAO"){if(typeof debug!=="undefined"){console.log("\t\tgeosetAlpha")}this.geosetAlpha=new MdxGeosetAlpha(c)}else{if(a==="KGAC"){if(typeof debug!=="undefined"){console.log("\t\tgeosetColor")}this.geosetColor=new MdxGeosetColor(c)}else{c.skip(-4)}}}}function MdxBone(a){}function MdxLight(a){}function MdxHelper(a){}function MdxAttachment(a){}function MdxPivotPoint(a){this.position=a.readFloat32Array(3)}function MdxParticleEmitter(a){}function MdxParticleEmitter2(a){}function MdxRibbonEmitter(a){}function MdxTrack(a){this.time=a.readUint32()}function MdxEventObject(a){}function MdxCamera(a){}function MdxCollisionShape(a){}function Mdx(a){var b=new BinaryStream(a);var c;this.versionChunk=null;this.modelChunk=null;this.sequenceChunk=null;this.globalSequenceChunk=null;this.textureChunk=null;this.layerChunk=null;this.materialChunk=null;this.textureAnimationChunk=null;this.geosetChunk=null;this.geosetAnimationChunk=null;this.boneChunk=null;this.lightChunk=null;this.helperChunk=null;this.attachmentChunk=null;this.pivotPointChunk=null;this.particleEmitterChunk=null;this.particleEmitter2Chunk=null;this.ribbonEmitterChunk=null;this.eventObjectChunk=null;this.cameraChunk=null;this.collisionShapeChunk=null;if(true===b.readExpected("MDLX")){while((c=b.readHeader())!==null){switch(c.token){case"VERS":this.versionChunk=new MdxVersionChunk(b,c.size);break;case"MODL":this.modelChunk=new MdxModelChunk(b,c.size);break;case"SEQS":this.sequenceChunk=new MdxSequenceChunk(b,c.size);break;case"GLBS":this.globalSequenceChunk=new MdxGlobalSequenceChunk(b,c.size);break;case"TEXS":this.textureChunk=new MdxTextureChunk(b,c.size);break;case"MTLS":this.materialChunk=new MdxMaterialChunk(b,c.size);break;case"TXAN":this.textureAnimationChunk=new MdxTextureAnimationChunk(b,c.size);break;case"GEOS":this.geosetChunk=new MdxGeosetChunk(b,c.size);break;case"GEOA":this.geosetAnimationChunk=new MdxGeosetAnimationChunk(b,c.size);break;case"BONE":this.boneChunk=new MdxBoneChunk(b,c.size);break;case"LITE":this.lightChunk=new MdxLightChunk(b,c.size);break;case"HELP":this.helperChunk=new MdxHelperChunk(b,c.size);break;case"ATCH":this.attachmentChunk=new MdxAttachmentChunk(b,c.size);break;case"PIVT":this.pivotPointChunk=new MdxPivotPointChunk(b,c.size);break;case"PREM":this.particleEmitterChunk=new MdxParticleEmitterChunk(b,c.size);break;case"PRE2":this.particleEmitter2Chunk=new MdxParticleEmitter2Chunk(b,c.size);break;case"RIBB":this.ribbonEmitterChunk=new MdxRibbonEmitterChunk(b,c.size);break;case"EVTS":this.eventObjectChunk=new MdxEventObjectChunk(b,c.size);break;case"CAMS":this.cameraChunk=new MdxCameraChunk(b,c.size);break;case"CLID":this.collisionShapeChunk=new MdxCollisionShapeChunk(b,c.size);break;default:throw"Exception: unknown chunk ID "+c.token}}}else{throw"Exception: Oops, "+a+" is not a MDX file"}}Mdx.prototype={draw:function(b){var e=this.geosetChunk.geosets;var a=this.materialChunk.materials;var d;for(d=0;d<e.length;d++){var h=e[d];var f=a[h.materialId];var c=f.layerChunk.layers[0];var g=this.textureChunk.textures[c.textureId].texture;Gl.state.bindTexture(Gl.TEXTURE0,g);b.uniform1i("texture",0);h.draw(b)}}};if(typeof window.DataView==="undefined"){alert("Your browser does not support DataView (Firefox?)")}var canvas;var width=500;var height=400;var Gl;var mouse={};var keys={};var t=0;var dt=0;var active=false;var delay=30;var active=false;var interval;var state;var mdx;var program;var translation=[0,0,-600];var rotation=[45,0,90];var scale=[1,1,1];var mouse={left:false,middle:false,right:false,pos0:{x:0,y:0},pos1:{x:0,y:0}};var grab=false;var moveModifier=-translation[2]*0.0015;function log(a){console.log(a)}function resizeWebGL(b,a){canvas.width=b;canvas.height=a;Gl.viewport(0,0,canvas.width,canvas.height);Gl.state.perspective(45,canvas.width/canvas.height,0.1,3000)}function onKeyPress(a){}function processEvents(){if(keys[37]){rotation[2]-=100*dt}if(keys[39]){rotation[2]+=100*dt}if(keys[38]){rotation[0]+=100*dt}if(keys[40]){rotation[0]-=100*dt}if(keys[33]){translation[2]+=500*dt;moveModifier=-translation[2]*0.0015}if(keys[34]){translation[2]-=500*dt;moveModifier=-translation[2]*0.0015}}function keyDown(a){keys[a.keyCode]=true;onKeyPress(a.keyCode)}function keyUp(a){keys[a.keyCode]=false}function mouseWheel(a){a.preventDefault();translation[2]+=a.wheelDelta/2;moveModifier=-translation[2]*0.0015}function mouseDown(a){mouse.pos0.x=mouse.pos1.x;mouse.pos0.y=mouse.pos1.y;mouse.pos1.x=a.clientX;mouse.pos1.y=a.clientY;switch(a.button){case 0:mouse.left=true;break;case 1:mouse.middle=true;break;case 2:mouse.right=true;break}grab=true}function mouseUp(a){mouse.pos0.x=mouse.pos1.x;mouse.pos0.y=mouse.pos1.y;mouse.pos1.x=a.clientX;mouse.pos1.y=a.clientY;switch(a.button){case 0:mouse.left=false;break;case 1:mouse.middle=false;break;case 2:mouse.right=false;break}grab=false}function disableTextSelect(a){a.cancelBubble=true;return false}function mouseMove(a){mouse.pos0.x=mouse.pos1.x;mouse.pos0.y=mouse.pos1.y;mouse.pos1.x=a.clientX;mouse.pos1.y=a.clientY;if(grab===true){if(mouse.left){rotation[2]-=mouse.pos1.x-mouse.pos0.x;rotation[0]-=mouse.pos1.y-mouse.pos0.y}if(mouse.right){translation[0]+=(mouse.pos1.x-mouse.pos0.x)*moveModifier;translation[1]-=(mouse.pos1.y-mouse.pos0.y)*moveModifier}}}function contextMenu(a){return false}function animate(){var a=new Date().getTime();if(t!==0){dt=(a-t);document.title=(1000/dt).toFixed();dt*=0.001}t=a}function draw(){Gl.clear(Gl.COLOR_BUFFER_BIT|Gl.DEPTH_BUFFER_BIT);Gl.state.loadIdentity();Gl.state.translate(translation);Gl.state.rotate(rotation[0],[1,0,0]);Gl.state.rotate(rotation[1],[0,1,0]);Gl.state.rotate(rotation[2],[0,0,1]);Gl.state.scale(scale);Gl.state.bindModelview("modelviewMatrix");mdx.draw(program)}function tick(){processEvents();animate();draw()}function activate(a){if(a===false){active=false;clearInterval(interval);document.title="Deactivated";document.getElementById("activate").innerHTML="Activate"}else{active=true;t=new Date().getTime();interval=setInterval(tick,delay);document.getElementById("activate").innerHTML="Deactivate"}}function test(b,a){canvas=b;try{Gl=canvas.getContext("experimental-webgl")}catch(c){}if(Gl){Gl.state=new GlState();mdx=new Mdx(a);program=Gl.state.createProgram("shader.vs","shader.fs");Gl.state.useProgram(program);resizeWebGL(width,height);Gl.state.bindProjection("projectionMatrix");Gl.clearColor(0.45,0.45,0.45,1);Gl.enable(Gl.DEPTH_TEST);Gl.depthFunc(Gl.LEQUAL);Gl.enable(Gl.CULL_FACE);Gl.cullFace(Gl.BACK);Gl.frontFace(Gl.CCW);document.onkeydown=keyDown;document.onkeyup=keyUp;canvas.onmousedown=mouseDown;canvas.onselectstart=disableTextSelect;document.onmouseup=mouseUp;document.onmousemove=mouseMove;canvas.onmousewheel=mouseWheel;canvas.oncontextmenu=contextMenu;active=true;interval=setInterval(tick,delay);document.getElementById("activate").innerHTML="Deactivate"}else{alert("Your browser does not support WebGL.")}};